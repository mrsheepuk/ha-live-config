# HA Live Config

A Home Assistant integration that stores shared configuration for the HA Live voice assistant app. This integration enables multiple household members to access shared conversation profiles and API keys through a centralized configuration system.

## Features

- Store shared Gemini API key for use by all household members
- Store conversation profiles accessible by all household members
- Automatic persistence across Home Assistant restarts
- RESTful service-based access for configuration management
- Support for multiple user profiles with different personalities and tools

## Installation

### Via HACS (Recommended)

1. In Home Assistant, go to HACS > Integrations
2. Click "Create automation" (or the menu button) and select "Custom repositories"
3. Add the HA Live repository URL as a custom repository with category "Integration"
4. Search for "HA Live Config" in HACS
5. Click Install
6. Restart Home Assistant

### Manual Installation

1. Clone or download the HA Live repository
2. Copy the `custom_components/ha_live_config` folder to your Home Assistant `config` folder
3. Your directory structure should be: `<config>/custom_components/ha_live_config/`
4. Restart Home Assistant

## Usage

This integration is used automatically by the HA Live Android app. The app communicates with these services to:

- Retrieve shared configuration on startup
- Store and update the Gemini API key
- Manage conversation profiles
- Persist settings across app sessions

No manual configuration is required. Once installed, the integration becomes available for the HA Live app to access.

## Services

### ha_live_config.get_config

Get all stored configuration (Gemini API key and all profiles).

**Service call example:**
```yaml
service: ha_live_config.get_config
```

**Response:**
```json
{
  "gemini_api_key": "YOUR_API_KEY",
  "profiles": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "Helpful Assistant",
      "system_prompt": "You are a helpful assistant...",
      "personality": "Friendly and supportive",
      "background_info": "Current time: {{ now() }}",
      "model": "gemini-2.0-flash-exp",
      "voice": "Aoede",
      "tool_filter_mode": "ALL",
      "selected_tools": [],
      "include_live_context": true,
      "enable_transcription": false,
      "auto_start_chat": false,
      "initial_message": "",
      "last_modified": "2024-01-15T10:30:00+00:00",
      "modified_by": "Admin",
      "schema_version": 1
    }
  ]
}
```

### ha_live_config.set_gemini_key

Set the shared Gemini API key.

**Service call example:**
```yaml
service: ha_live_config.set_gemini_key
data:
  api_key: "your-gemini-api-key-here"
```

### ha_live_config.upsert_profile

Create a new profile or update an existing profile.

**Service call example:**
```yaml
service: ha_live_config.upsert_profile
data:
  profile:
    name: "My Custom Assistant"
    system_prompt: "You are a helpful home automation assistant..."
    personality: "Knowledgeable and efficient"
    background_info: "Home status: {{ states('light.living_room') }}"
    model: "gemini-2.0-flash-exp"
    voice: "Leda"
    tool_filter_mode: "SELECTED"
    selected_tools:
      - "light.turn_on"
      - "light.turn_off"
      - "light.toggle"
    include_live_context: true
    enable_transcription: false
    auto_start_chat: false
    initial_message: ""
```

To update an existing profile, include the `id` field:
```yaml
service: ha_live_config.upsert_profile
data:
  profile:
    id: "550e8400-e29b-41d4-a716-446655440000"
    name: "My Custom Assistant"
    system_prompt: "Updated system prompt..."
```

### ha_live_config.delete_profile

Delete a stored profile by ID.

**Service call example:**
```yaml
service: ha_live_config.delete_profile
data:
  profile_id: "custom_profile"
```

### ha_live_config.check_profile_name

Check if a profile name is available (not already in use).

**Service call example:**
```yaml
service: ha_live_config.check_profile_name
data:
  name: "New Profile Name"
```

**Response:**
```json
{
  "available": true
}
```

## Configuration Storage

All configuration is automatically persisted to:
```
.storage/ha_live_config
```

This file is managed by Home Assistant and backed up with your Home Assistant configuration. Do not edit this file manually.

## Troubleshooting

- **HA Live app cannot connect**: Ensure the integration is installed and Home Assistant is running
- **API key not saving**: Check Home Assistant logs for any errors during the service call
- **Profiles not syncing**: Restart Home Assistant to ensure the latest configuration is loaded
